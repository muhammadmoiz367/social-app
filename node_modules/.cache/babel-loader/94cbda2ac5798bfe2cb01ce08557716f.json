{"ast":null,"code":"import firebase, { db } from '../firebase/firebase';\nimport { GET_POSTS, CREATE_POST, GET_SPECIFIC_POST, CREATE_NEW_COMMENT } from '../actionConstants';\nimport 'firebase/firestore';\n\nfunction getPosts(data) {\n  return {\n    type: GET_POSTS,\n    data\n  };\n}\n\nfunction createNewPost(post) {\n  return {\n    type: CREATE_POST,\n    data: post\n  };\n}\n\nfunction getSpecificPostData(data) {\n  return {\n    type: GET_SPECIFIC_POST,\n    data\n  };\n}\n\nfunction createNewComment(comment) {\n  return {\n    type: CREATE_NEW_COMMENT,\n    data: comment\n  };\n}\n\nexport const handleInitialData = () => {\n  return (dispatch, getState, {\n    getFirebase,\n    getFirestore\n  }) => {\n    const firebase = getFirebase();\n    const firestore = getFirebase().firestore();\n    let id;\n    let posts = {};\n    db.collection(\"posts\").orderBy('createdAt', 'desc').get().then(querySnapshot => {\n      querySnapshot.forEach(doc => {\n        id = doc.id;\n        posts[id] = doc.data();\n      });\n      dispatch(getPosts(posts));\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n};\nexport const createPost = (newPost, history) => {\n  return (dispatch, getState, {\n    getFirebase,\n    getFirestore\n  }) => {\n    db.collection(\"posts\").add(newPost).then(doc => {\n      console.log('document written successfully with id: ', doc.id);\n      db.doc(`/posts/${doc.id}`).get().then(doc => {\n        let newPostData = {};\n        newPostData = doc.data();\n        newPostData.id = doc.id;\n        dispatch(createNewPost(newPostData));\n        history.push('/');\n      }).catch(err => {\n        console.log(err);\n      });\n    });\n  };\n};\nexport const getSpecificPost = id => {\n  return (dispatch, {\n    getFirebase,\n    getFirestore\n  }) => {\n    let postData = {};\n    db.doc(`/posts/${id}`).get().then(doc => {\n      if (!doc.exists) {\n        console.log('Document not existed');\n      }\n\n      postData = doc.data();\n      postData.postId = doc.id;\n      return db.collection('comments').orderBy('createdAt', 'desc').where('postId', '==', id).get();\n    }).then(data => {\n      postData.comments = [];\n      data.forEach(doc => {\n        postData.comments.push(doc.data());\n      });\n      return db.collection('likes').where('postId', '==', id).get();\n    }).then(data => {\n      postData.likes = [];\n      data.forEach(doc => {\n        postData.likes.push(doc.data());\n      });\n      dispatch(getSpecificPostData(postData));\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n};\nexport const commentOnPost = (newComment, postId) => {\n  return dispatch => {\n    db.doc(`/posts/${postId}`).get().then(doc => {\n      if (!doc.exists) {\n        console.log('Post not found');\n      }\n\n      return doc.ref.update({\n        commentCount: doc.data().commentCount + 1\n      });\n    }).then(() => {\n      return db.collection('comments').add(newComment);\n    }).then(doc => {\n      console.log('new comment added with id: ', doc.id);\n      db.doc(`/comments/${doc.id}`).get();\n    }).then(doc => {\n      dispatch(createNewComment(doc.data()));\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n}; //like on post\n\nexport const likePost = (postId, handle) => {\n  const likeDocument = db.collection('likes').where('userHandle', '==', handle).where('postId', '==', postId).limit(1);\n  const postDocument = db.doc(`/posts/${postId}`);\n  let postData;\n  postDocument.get().then(doc => {\n    if (doc.exists) {\n      postData = doc.data();\n      postData.postId = doc.id;\n      return likeDocument.get();\n    } else {\n      return res.status(404).json({\n        error: 'post not found'\n      });\n    }\n  }).then(data => {\n    if (data.empty) {\n      return db.collection('likes').add({\n        postId: postId,\n        userHandle: handle\n      }).then(() => {\n        postData.likeCount++;\n        return postDocument.update({\n          likeCount: postData.likeCount\n        });\n      }).then(() => {\n        return postData;\n      });\n    } else {\n      return res.status(400).json({\n        error: 'post already liked'\n      });\n    }\n  }).catch(err => {\n    console.error(err);\n    res.status(500).json({\n      error: err.code\n    });\n  });\n};","map":{"version":3,"sources":["E:/react/react-redux/social-app/src/actions/dataActions.js"],"names":["firebase","db","GET_POSTS","CREATE_POST","GET_SPECIFIC_POST","CREATE_NEW_COMMENT","getPosts","data","type","createNewPost","post","getSpecificPostData","createNewComment","comment","handleInitialData","dispatch","getState","getFirebase","getFirestore","firestore","id","posts","collection","orderBy","get","then","querySnapshot","forEach","doc","catch","err","console","log","createPost","newPost","history","add","newPostData","push","getSpecificPost","postData","exists","postId","where","comments","likes","commentOnPost","newComment","ref","update","commentCount","likePost","handle","likeDocument","limit","postDocument","res","status","json","error","empty","userHandle","likeCount","code"],"mappings":"AACA,OAAOA,QAAP,IAAmBC,EAAnB,QAA6B,sBAA7B;AACA,SAAQC,SAAR,EAAmBC,WAAnB,EAAgCC,iBAAhC,EAAmDC,kBAAnD,QAA4E,oBAA5E;AACA,OAAO,oBAAP;;AAEA,SAASC,QAAT,CAAkBC,IAAlB,EAAuB;AACrB,SAAM;AACJC,IAAAA,IAAI,EAAEN,SADF;AAEJK,IAAAA;AAFI,GAAN;AAID;;AACD,SAASE,aAAT,CAAuBC,IAAvB,EAA4B;AAC1B,SAAM;AACJF,IAAAA,IAAI,EAAEL,WADF;AAEJI,IAAAA,IAAI,EAAEG;AAFF,GAAN;AAID;;AACD,SAASC,mBAAT,CAA6BJ,IAA7B,EAAkC;AAChC,SAAM;AACJC,IAAAA,IAAI,EAAEJ,iBADF;AAEJG,IAAAA;AAFI,GAAN;AAID;;AACD,SAASK,gBAAT,CAA0BC,OAA1B,EAAkC;AAChC,SAAM;AACJL,IAAAA,IAAI,EAAEH,kBADF;AAEJE,IAAAA,IAAI,EAAEM;AAFF,GAAN;AAID;;AAED,OAAO,MAAMC,iBAAiB,GAAC,MAAI;AACjC,SAAO,CAACC,QAAD,EAAWC,QAAX,EAAqB;AAACC,IAAAA,WAAD;AAAcC,IAAAA;AAAd,GAArB,KAAmD;AACxD,UAAMlB,QAAQ,GAACiB,WAAW,EAA1B;AACA,UAAME,SAAS,GAACF,WAAW,GAAGE,SAAd,EAAhB;AACA,QAAIC,EAAJ;AACA,QAAIC,KAAK,GAAC,EAAV;AACApB,IAAAA,EAAE,CAACqB,UAAH,CAAc,OAAd,EAAuBC,OAAvB,CAA+B,WAA/B,EAA4C,MAA5C,EAAoDC,GAApD,GACCC,IADD,CACOC,aAAD,IAAmB;AACvBA,MAAAA,aAAa,CAACC,OAAd,CAAuBC,GAAD,IAAQ;AAC9BR,QAAAA,EAAE,GAACQ,GAAG,CAACR,EAAP;AACAC,QAAAA,KAAK,CAACD,EAAD,CAAL,GAAUQ,GAAG,CAACrB,IAAJ,EAAV;AACE,OAHF;AAIAQ,MAAAA,QAAQ,CAACT,QAAQ,CAACe,KAAD,CAAT,CAAR;AACD,KAPD,EAQCQ,KARD,CAQOC,GAAG,IAAE;AACVC,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD,KAVD;AAWD,GAhBD;AAiBD,CAlBM;AAoBP,OAAO,MAAMG,UAAU,GAAC,CAACC,OAAD,EAAUC,OAAV,KAAoB;AAC1C,SAAO,CAACpB,QAAD,EAAWC,QAAX,EAAqB;AAACC,IAAAA,WAAD;AAAcC,IAAAA;AAAd,GAArB,KAAmD;AACxDjB,IAAAA,EAAE,CAACqB,UAAH,CAAc,OAAd,EAAuBc,GAAvB,CAA2BF,OAA3B,EACCT,IADD,CACMG,GAAG,IAAE;AACTG,MAAAA,OAAO,CAACC,GAAR,CAAY,yCAAZ,EAAsDJ,GAAG,CAACR,EAA1D;AACAnB,MAAAA,EAAE,CAAC2B,GAAH,CAAQ,UAASA,GAAG,CAACR,EAAG,EAAxB,EAA2BI,GAA3B,GACCC,IADD,CACMG,GAAG,IAAE;AACT,YAAIS,WAAW,GAAC,EAAhB;AACAA,QAAAA,WAAW,GAACT,GAAG,CAACrB,IAAJ,EAAZ;AACA8B,QAAAA,WAAW,CAACjB,EAAZ,GAAeQ,GAAG,CAACR,EAAnB;AACAL,QAAAA,QAAQ,CAACN,aAAa,CAAC4B,WAAD,CAAd,CAAR;AACAF,QAAAA,OAAO,CAACG,IAAR,CAAa,GAAb;AACD,OAPD,EAQCT,KARD,CAQOC,GAAG,IAAE;AACVC,QAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD,OAVD;AAWD,KAdD;AAeD,GAhBD;AAiBD,CAlBM;AAoBP,OAAO,MAAMS,eAAe,GAAEnB,EAAD,IAAM;AACjC,SAAO,CAACL,QAAD,EAAW;AAACE,IAAAA,WAAD;AAAcC,IAAAA;AAAd,GAAX,KAAyC;AAC9C,QAAIsB,QAAQ,GAAG,EAAf;AACAvC,IAAAA,EAAE,CAAC2B,GAAH,CAAQ,UAASR,EAAG,EAApB,EAAuBI,GAAvB,GACCC,IADD,CACOG,GAAD,IAAS;AACf,UAAI,CAACA,GAAG,CAACa,MAAT,EAAiB;AACbV,QAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACH;;AACDQ,MAAAA,QAAQ,GAAGZ,GAAG,CAACrB,IAAJ,EAAX;AACAiC,MAAAA,QAAQ,CAACE,MAAT,GAAkBd,GAAG,CAACR,EAAtB;AACA,aAAOnB,EAAE,CAACqB,UAAH,CAAc,UAAd,EAA0BC,OAA1B,CAAkC,WAAlC,EAA+C,MAA/C,EAAuDoB,KAAvD,CAA6D,QAA7D,EAAuE,IAAvE,EAA6EvB,EAA7E,EAAiFI,GAAjF,EAAP;AACC,KARD,EASCC,IATD,CASOlB,IAAD,IAAU;AACZiC,MAAAA,QAAQ,CAACI,QAAT,GAAoB,EAApB;AACArC,MAAAA,IAAI,CAACoB,OAAL,CAAcC,GAAD,IAAS;AAClBY,QAAAA,QAAQ,CAACI,QAAT,CAAkBN,IAAlB,CAAuBV,GAAG,CAACrB,IAAJ,EAAvB;AACH,OAFD;AAGA,aAAON,EAAE,CAACqB,UAAH,CAAc,OAAd,EAAuBqB,KAAvB,CAA6B,QAA7B,EAAuC,IAAvC,EAA6CvB,EAA7C,EAAiDI,GAAjD,EAAP;AACH,KAfD,EAgBCC,IAhBD,CAgBOlB,IAAD,IAAU;AACZiC,MAAAA,QAAQ,CAACK,KAAT,GAAiB,EAAjB;AACAtC,MAAAA,IAAI,CAACoB,OAAL,CAAcC,GAAD,IAAS;AAClBY,QAAAA,QAAQ,CAACK,KAAT,CAAeP,IAAf,CAAoBV,GAAG,CAACrB,IAAJ,EAApB;AACH,OAFD;AAGAQ,MAAAA,QAAQ,CAACJ,mBAAmB,CAAC6B,QAAD,CAApB,CAAR;AACH,KAtBD,EAuBCX,KAvBD,CAuBQC,GAAD,IAAS;AACZC,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACH,KAzBD;AA0BD,GA5BD;AA6BD,CA9BM;AA+BP,OAAO,MAAMgB,aAAa,GAAC,CAACC,UAAD,EAAaL,MAAb,KAAsB;AAC/C,SAAQ3B,QAAD,IAAY;AACjBd,IAAAA,EAAE,CAAC2B,GAAH,CAAQ,UAASc,MAAO,EAAxB,EAA2BlB,GAA3B,GACCC,IADD,CACOG,GAAD,IAAO;AACX,UAAG,CAACA,GAAG,CAACa,MAAR,EAAe;AACXV,QAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AACH;;AACD,aAAOJ,GAAG,CAACoB,GAAJ,CAAQC,MAAR,CAAe;AAAEC,QAAAA,YAAY,EAAEtB,GAAG,CAACrB,IAAJ,GAAW2C,YAAX,GAAwB;AAAxC,OAAf,CAAP;AACD,KAND,EAOCzB,IAPD,CAOM,MAAI;AACR,aAAOxB,EAAE,CAACqB,UAAH,CAAc,UAAd,EAA0Bc,GAA1B,CAA8BW,UAA9B,CAAP;AACD,KATD,EAUCtB,IAVD,CAUOG,GAAD,IAAO;AACXG,MAAAA,OAAO,CAACC,GAAR,CAAY,6BAAZ,EAA2CJ,GAAG,CAACR,EAA/C;AACAnB,MAAAA,EAAE,CAAC2B,GAAH,CAAQ,aAAYA,GAAG,CAACR,EAAG,EAA3B,EAA8BI,GAA9B;AACD,KAbD,EAcCC,IAdD,CAcMG,GAAG,IAAE;AACTb,MAAAA,QAAQ,CAACH,gBAAgB,CAACgB,GAAG,CAACrB,IAAJ,EAAD,CAAjB,CAAR;AACD,KAhBD,EAiBCsB,KAjBD,CAiBQC,GAAD,IAAO;AACZC,MAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ;AACD,KAnBD;AAoBD,GArBD;AAsBD,CAvBM,C,CAwBP;;AACA,OAAO,MAAMqB,QAAQ,GAAG,CAACT,MAAD,EAASU,MAAT,KAAoB;AAC1C,QAAMC,YAAY,GAAGpD,EAAE,CAACqB,UAAH,CAAc,OAAd,EAAuBqB,KAAvB,CAA6B,YAA7B,EAA2C,IAA3C,EAAiDS,MAAjD,EAAyDT,KAAzD,CAA+D,QAA/D,EAAyE,IAAzE,EAA+ED,MAA/E,EAAuFY,KAAvF,CAA6F,CAA7F,CAArB;AACA,QAAMC,YAAY,GAAGtD,EAAE,CAAC2B,GAAH,CAAQ,UAASc,MAAO,EAAxB,CAArB;AACA,MAAIF,QAAJ;AAEAe,EAAAA,YAAY,CAAC/B,GAAb,GACCC,IADD,CACOG,GAAD,IAAS;AACX,QAAIA,GAAG,CAACa,MAAR,EAAgB;AACZD,MAAAA,QAAQ,GAAGZ,GAAG,CAACrB,IAAJ,EAAX;AACAiC,MAAAA,QAAQ,CAACE,MAAT,GAAkBd,GAAG,CAACR,EAAtB;AACA,aAAOiC,YAAY,CAAC7B,GAAb,EAAP;AACH,KAJD,MAIO;AACH,aAAOgC,GAAG,CAACC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,QAAAA,KAAK,EAAE;AAAT,OAArB,CAAP;AACH;AACJ,GATD,EAUClC,IAVD,CAUOlB,IAAD,IAAU;AACZ,QAAIA,IAAI,CAACqD,KAAT,EAAgB;AACZ,aAAO3D,EAAE,CAACqB,UAAH,CAAc,OAAd,EAAuBc,GAAvB,CAA2B;AAC9BM,QAAAA,MAAM,EAAEA,MADsB;AAE9BmB,QAAAA,UAAU,EAAET;AAFkB,OAA3B,EAIN3B,IAJM,CAID,MAAM;AACRe,QAAAA,QAAQ,CAACsB,SAAT;AACA,eAAOP,YAAY,CAACN,MAAb,CAAoB;AAAEa,UAAAA,SAAS,EAAEtB,QAAQ,CAACsB;AAAtB,SAApB,CAAP;AACH,OAPM,EAQNrC,IARM,CAQD,MAAM;AACR,eAAOe,QAAP;AACH,OAVM,CAAP;AAWH,KAZD,MAYO;AACH,aAAOgB,GAAG,CAACC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,QAAAA,KAAK,EAAE;AAAT,OAArB,CAAP;AACH;AACJ,GA1BD,EA2BC9B,KA3BD,CA2BQC,GAAD,IAAS;AACZC,IAAAA,OAAO,CAAC4B,KAAR,CAAc7B,GAAd;AACA0B,IAAAA,GAAG,CAACC,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,MAAAA,KAAK,EAAE7B,GAAG,CAACiC;AAAb,KAArB;AACH,GA9BD;AA+BD,CApCM","sourcesContent":["\r\nimport firebase, { db } from '../firebase/firebase';\r\nimport {GET_POSTS, CREATE_POST, GET_SPECIFIC_POST, CREATE_NEW_COMMENT} from '../actionConstants'\r\nimport 'firebase/firestore';\r\n\r\nfunction getPosts(data){\r\n  return{\r\n    type: GET_POSTS,\r\n    data\r\n  }\r\n}\r\nfunction createNewPost(post){\r\n  return{\r\n    type: CREATE_POST,\r\n    data: post\r\n  }\r\n}\r\nfunction getSpecificPostData(data){\r\n  return{\r\n    type: GET_SPECIFIC_POST,\r\n    data\r\n  }\r\n}\r\nfunction createNewComment(comment){\r\n  return{\r\n    type: CREATE_NEW_COMMENT,\r\n    data: comment\r\n  }\r\n}\r\n\r\nexport const handleInitialData=()=>{\r\n  return (dispatch, getState, {getFirebase, getFirestore})=>{\r\n    const firebase=getFirebase();\r\n    const firestore=getFirebase().firestore()\r\n    let id;\r\n    let posts={}\r\n    db.collection(\"posts\").orderBy('createdAt', 'desc').get()\r\n    .then((querySnapshot) => {\r\n      querySnapshot.forEach((doc) =>{\r\n      id=doc.id;\r\n      posts[id]=doc.data();\r\n       });\r\n      dispatch(getPosts(posts))\r\n    })\r\n    .catch(err=>{\r\n      console.log(err)\r\n    })\r\n  }\r\n}\r\n\r\nexport const createPost=(newPost, history)=>{\r\n  return (dispatch, getState, {getFirebase, getFirestore})=>{\r\n    db.collection(\"posts\").add(newPost)\r\n    .then(doc=>{\r\n      console.log('document written successfully with id: ',doc.id )\r\n      db.doc(`/posts/${doc.id}`).get()\r\n      .then(doc=>{\r\n        let newPostData={}\r\n        newPostData=doc.data()\r\n        newPostData.id=doc.id\r\n        dispatch(createNewPost(newPostData))\r\n        history.push('/')\r\n      })\r\n      .catch(err=>{\r\n        console.log(err)\r\n      })\r\n    })\r\n  }\r\n}\r\n\r\nexport const getSpecificPost=(id)=>{\r\n  return (dispatch, {getFirebase, getFirestore})=>{\r\n    let postData = {};\r\n    db.doc(`/posts/${id}`).get()\r\n    .then((doc) => {\r\n    if (!doc.exists) {\r\n        console.log('Document not existed')\r\n    }\r\n    postData = doc.data();\r\n    postData.postId = doc.id;\r\n    return db.collection('comments').orderBy('createdAt', 'desc').where('postId', '==', id).get();\r\n    })\r\n    .then((data) => {\r\n        postData.comments = [];\r\n        data.forEach((doc) => {\r\n            postData.comments.push(doc.data());\r\n        });\r\n        return db.collection('likes').where('postId', '==', id).get();\r\n    })\r\n    .then((data) => {\r\n        postData.likes = [];\r\n        data.forEach((doc) => {\r\n            postData.likes.push(doc.data());\r\n        });\r\n        dispatch(getSpecificPostData(postData))\r\n    })\r\n    .catch((err) => {\r\n        console.log(err);\r\n    });\r\n  }\r\n}\r\nexport const commentOnPost=(newComment, postId)=>{\r\n  return (dispatch)=>{\r\n    db.doc(`/posts/${postId}`).get()\r\n    .then((doc)=>{\r\n      if(!doc.exists){\r\n          console.log('Post not found');\r\n      }\r\n      return doc.ref.update({ commentCount: doc.data().commentCount+1});\r\n    })\r\n    .then(()=>{\r\n      return db.collection('comments').add(newComment);\r\n    })\r\n    .then((doc)=>{\r\n      console.log('new comment added with id: ', doc.id)\r\n      db.doc(`/comments/${doc.id}`).get()\r\n    })\r\n    .then(doc=>{\r\n      dispatch(createNewComment(doc.data()))\r\n    })\r\n    .catch((err)=>{\r\n      console.log(err);\r\n    })\r\n  }\r\n}\r\n//like on post\r\nexport const likePost = (postId, handle) => {\r\n  const likeDocument = db.collection('likes').where('userHandle', '==', handle).where('postId', '==', postId).limit(1);\r\n  const postDocument = db.doc(`/posts/${postId}`);\r\n  let postData;\r\n\r\n  postDocument.get()\r\n  .then((doc) => {\r\n      if (doc.exists) {\r\n          postData = doc.data();\r\n          postData.postId = doc.id;\r\n          return likeDocument.get();\r\n      } else {\r\n          return res.status(404).json({ error: 'post not found' });\r\n      }\r\n  })\r\n  .then((data) => {\r\n      if (data.empty) {\r\n          return db.collection('likes').add({\r\n              postId: postId,\r\n              userHandle: handle\r\n          })\r\n          .then(() => {\r\n              postData.likeCount++;\r\n              return postDocument.update({ likeCount: postData.likeCount });\r\n          })\r\n          .then(() => {\r\n              return postData;\r\n          });\r\n      } else {\r\n          return res.status(400).json({ error: 'post already liked' });\r\n      }\r\n  })\r\n  .catch((err) => {\r\n      console.error(err);\r\n      res.status(500).json({ error: err.code });\r\n  });\r\n};"]},"metadata":{},"sourceType":"module"}