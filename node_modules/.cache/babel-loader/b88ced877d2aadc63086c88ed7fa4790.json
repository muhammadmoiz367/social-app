{"ast":null,"code":"import firebase, { db, firebaseConfig } from '../firebase/firebase';\nimport { signUpValidate, loginValidate } from '../utils/validators';\nimport { SET_ERRORS, CLEAR_ERRORS, LOADING_UI, SET_USER, SET_UNAUTHENTICATED, SET_AUTHENTICATED, SIGNOUT_ERROR, GET_SPECIFIC_USER } from '../actionConstants';\nimport 'firebase/auth';\nimport 'firebase/firestore';\n\nfunction loadingUi() {\n  return {\n    type: LOADING_UI\n  };\n}\n\nfunction clearErrors() {\n  return {\n    type: CLEAR_ERRORS\n  };\n}\n\nfunction setUser(data) {\n  return {\n    type: SET_USER,\n    data\n  };\n}\n\nfunction setErrors(errors) {\n  return {\n    type: SET_ERRORS,\n    errors\n  };\n}\n\nfunction setUnauthenticated() {\n  return {\n    type: SET_UNAUTHENTICATED\n  };\n}\n\nfunction setAuthenticated() {\n  return {\n    type: SET_AUTHENTICATED\n  };\n}\n\nfunction signoutError(err) {\n  return {\n    type: SIGNOUT_ERROR,\n    err\n  };\n}\n\nfunction getSpecificUserData(data) {\n  return {\n    type: GET_SPECIFIC_USER,\n    data\n  };\n}\n\nexport const signIn = (credentials, history) => {\n  return (dispatch, getState, {\n    getFirebase,\n    getFirestore\n  }) => {\n    const firebase = getFirebase();\n    const firestore = getFirebase().firestore();\n    dispatch(loadingUi());\n    const {\n      isValid,\n      errors\n    } = loginValidate(credentials);\n\n    if (!isValid) {\n      dispatch(setErrors(errors));\n    }\n\n    firebase.auth().signInWithEmailAndPassword(credentials.email, credentials.password).then(res => {\n      let token = `Bearer ${res.user.refreshToken}`;\n      localStorage.setItem('FBIdToken', token);\n      dispatch(clearErrors());\n      db.collection(\"users\").where('uid', '==', res.user.uid).get().then(querySnapshot => {\n        querySnapshot.forEach(doc => {\n          dispatch(setAuthenticated());\n          dispatch(setUser(doc.data()));\n        });\n        history.push('/');\n      });\n    }).catch(err => {\n      console.log(err);\n\n      if (err.code === \"auth/user-not-found\") {\n        dispatch(setErrors({\n          general: 'User not found'\n        }));\n      }\n\n      if (err.code === 'auth/wrong-password') {\n        dispatch(setErrors({\n          general: 'Wrong password'\n        }));\n      }\n    });\n  };\n};\nexport const signUp = (newUser, history) => {\n  return (dispatch, getState, {\n    getFirebase,\n    getFirestore\n  }) => {\n    const firebase = getFirebase();\n    const firestore = getFirebase().firestore();\n    dispatch(loadingUi());\n    const {\n      isValid,\n      errors\n    } = signUpValidate(newUser);\n\n    if (!isValid) {\n      dispatch(setErrors(errors));\n    }\n\n    let uid;\n    const noImage = 'no-image.png';\n    db.collection(\"users\").doc(newUser.userHandle).get().then(doc => {\n      if (doc.exists) {\n        console.log('this handle is already taken');\n        dispatch(setErrors({\n          general: 'This handle is already taken'\n        }));\n      } else {\n        return firebase.auth().createUserWithEmailAndPassword(newUser.email, newUser.password);\n      }\n    }).then(data => {\n      let token = `Bearer ${data.user.refreshToken}`;\n      localStorage.setItem('FBIdToken', token);\n      uid = data.user.uid;\n      dispatch(clearErrors());\n      const userCredentials = {\n        handle: newUser.userHandle,\n        email: newUser.email,\n        createdAt: new Date().toISOString(),\n        imageUrl: `https://firebasestorage.googleapis.com/v0/b/${firebaseConfig.storageBucket}/o/${noImage}?alt=media`,\n        uid\n      };\n      return db.doc(`/users/${newUser.userHandle}`).set(userCredentials);\n    }).then(() => {\n      dispatch(clearErrors());\n      db.collection(\"users\").where('uid', '==', uid).get().then(querySnapshot => {\n        querySnapshot.forEach(doc => {\n          localStorage.setItem('UserData', doc.data());\n          dispatch(setUser(doc.data()));\n        });\n        history.push('/');\n      });\n    }).catch(err => {\n      if (err.code === 'auth/email-already-in-use') {\n        dispatch(setErrors({\n          general: 'Email already in use'\n        }));\n      }\n    });\n  };\n};\nexport const signOut = () => {\n  return (dispatch, getState, {\n    getFirebase\n  }) => {\n    const firebase = getFirebase();\n    firebase.auth().signOut().then(() => {\n      localStorage.removeItem('FBIdToken');\n      localStorage.removeItem('userData');\n      dispatch(setUnauthenticated());\n      window.location.reload();\n    }).catch(err => {\n      dispatch(signoutError(err));\n    });\n  };\n};\nexport const getSpecific = handle => {\n  return dispatch => {\n    let userData = {};\n    db.doc(`/users/${handle}`).get().then(doc => {\n      if (doc.exists) {\n        userData.user = doc.data();\n        return db.collection('posts').where('userHandle', '==', handle).orderBy('createdAt', 'desc').get();\n      } else {\n        console.log('User not found');\n      }\n    }).then(data => {\n      userData.posts = [];\n      data.forEach(doc => {\n        userData.posts.push({\n          body: doc.data().body,\n          createdAt: doc.data().createdAt,\n          userHandle: doc.data().userHandle,\n          userImage: doc.data().userImage,\n          likeCount: doc.data().likeCount,\n          commentCount: doc.data().commentCount,\n          postImage: doc.data().postImage,\n          postId: doc.id\n        });\n      });\n      dispatch(getSpecificUserData(userData));\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n};","map":{"version":3,"sources":["F:/react/react-redux/social-app/src/actions/authUserActions.js"],"names":["firebase","db","firebaseConfig","signUpValidate","loginValidate","SET_ERRORS","CLEAR_ERRORS","LOADING_UI","SET_USER","SET_UNAUTHENTICATED","SET_AUTHENTICATED","SIGNOUT_ERROR","GET_SPECIFIC_USER","loadingUi","type","clearErrors","setUser","data","setErrors","errors","setUnauthenticated","setAuthenticated","signoutError","err","getSpecificUserData","signIn","credentials","history","dispatch","getState","getFirebase","getFirestore","firestore","isValid","auth","signInWithEmailAndPassword","email","password","then","res","token","user","refreshToken","localStorage","setItem","collection","where","uid","get","querySnapshot","forEach","doc","push","catch","console","log","code","general","signUp","newUser","noImage","userHandle","exists","createUserWithEmailAndPassword","userCredentials","handle","createdAt","Date","toISOString","imageUrl","storageBucket","set","signOut","removeItem","window","location","reload","getSpecific","userData","orderBy","posts","body","userImage","likeCount","commentCount","postImage","postId","id"],"mappings":"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","sourcesContent":["import firebase, { db, firebaseConfig } from '../firebase/firebase';\r\nimport {signUpValidate, loginValidate} from '../utils/validators';\r\n\r\nimport {\r\n    SET_ERRORS,\r\n    CLEAR_ERRORS,\r\n    LOADING_UI,\r\n    SET_USER,\r\n    SET_UNAUTHENTICATED,\r\n    SET_AUTHENTICATED,\r\n    SIGNOUT_ERROR,\r\n    GET_SPECIFIC_USER\r\n} from '../actionConstants';\r\nimport 'firebase/auth';\r\nimport 'firebase/firestore';\r\n\r\nfunction loadingUi(){\r\n    return{\r\n        type: LOADING_UI\r\n    }\r\n}\r\nfunction clearErrors(){\r\n    return{\r\n        type: CLEAR_ERRORS\r\n    }\r\n}\r\nfunction setUser(data){\r\n    return{\r\n        type: SET_USER,\r\n        data\r\n    }\r\n}\r\nfunction setErrors(errors){\r\n    return{\r\n        type: SET_ERRORS,\r\n        errors\r\n    }\r\n}\r\nfunction setUnauthenticated(){\r\n    return{\r\n        type: SET_UNAUTHENTICATED\r\n    }\r\n}\r\nfunction setAuthenticated(){\r\n    return{\r\n        type: SET_AUTHENTICATED\r\n    }\r\n}\r\nfunction signoutError(err){\r\n    return{\r\n        type: SIGNOUT_ERROR,\r\n        err\r\n    }\r\n}\r\nfunction getSpecificUserData(data){\r\n    return{\r\n        type: GET_SPECIFIC_USER,\r\n        data\r\n    }\r\n}\r\n\r\nexport const signIn=(credentials,history)=>{\r\n    return (dispatch, getState, {getFirebase, getFirestore})=>{\r\n        const firebase=getFirebase();\r\n        const firestore=getFirebase().firestore()\r\n        dispatch(loadingUi())\r\n        const {isValid, errors} = loginValidate(credentials)\r\n        if(!isValid){\r\n            dispatch(setErrors(errors))\r\n        }\r\n        firebase.auth().signInWithEmailAndPassword(\r\n            credentials.email,\r\n            credentials.password\r\n        )\r\n        .then((res)=>{\r\n            let token=`Bearer ${res.user.refreshToken}`\r\n            localStorage.setItem('FBIdToken',token)\r\n            dispatch(clearErrors())\r\n            db.collection(\"users\").where('uid','==',res.user.uid).get()\r\n            .then((querySnapshot) => {\r\n                querySnapshot.forEach((doc) =>{\r\n                    dispatch(setAuthenticated())\r\n                    dispatch(setUser(doc.data()))\r\n                });\r\n                history.push('/')\r\n            });\r\n        })\r\n        .catch((err)=>{\r\n            console.log(err)\r\n            if(err.code===\"auth/user-not-found\"){\r\n                dispatch(setErrors({general: 'User not found'}))\r\n            }\r\n            if(err.code === 'auth/wrong-password'){\r\n                dispatch(setErrors({general: 'Wrong password'}))\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\n\r\nexport const signUp=(newUser,history)=>{\r\n    return (dispatch, getState, {getFirebase, getFirestore})=>{\r\n        const firebase=getFirebase();\r\n        const firestore=getFirebase().firestore();\r\n        dispatch(loadingUi())\r\n        const {isValid, errors} = signUpValidate(newUser)\r\n        if(!isValid){\r\n            dispatch(setErrors(errors))\r\n        }\r\n        let uid;\r\n        const noImage='no-image.png';\r\n        db.collection(\"users\").doc(newUser.userHandle).get()\r\n        .then((doc)=>{\r\n            if(doc.exists){\r\n                console.log('this handle is already taken')\r\n                dispatch(setErrors({general: 'This handle is already taken'}))\r\n            }\r\n            else{\r\n                return firebase.auth().createUserWithEmailAndPassword(newUser.email,newUser.password)\r\n            }\r\n        })\r\n        .then(data=>{\r\n            let token=`Bearer ${data.user.refreshToken}`\r\n            localStorage.setItem('FBIdToken',token)\r\n            uid=data.user.uid;\r\n            dispatch(clearErrors())\r\n            const userCredentials={\r\n                handle:newUser.userHandle,\r\n                email:newUser.email,\r\n                createdAt:new Date().toISOString(),\r\n                imageUrl:`https://firebasestorage.googleapis.com/v0/b/${firebaseConfig.storageBucket}/o/${noImage}?alt=media`,\r\n                uid\r\n            }\r\n            return db.doc(`/users/${newUser.userHandle}`).set(userCredentials)\r\n        })\r\n        .then(()=>{\r\n            dispatch(clearErrors())\r\n            db.collection(\"users\").where('uid','==',uid).get()\r\n            .then((querySnapshot) => {\r\n                querySnapshot.forEach((doc) =>{\r\n                    localStorage.setItem('UserData',doc.data())\r\n                    dispatch(setUser(doc.data()))\r\n                });\r\n                history.push('/')\r\n            });\r\n        })\r\n        .catch((err)=>{\r\n            if(err.code === 'auth/email-already-in-use'){\r\n                dispatch(setErrors({general: 'Email already in use'}))\r\n            }\r\n        })\r\n    }\r\n}\r\n\r\nexport const signOut=()=>{\r\n    return (dispatch,getState,{getFirebase})=>{\r\n        const firebase=getFirebase();\r\n        firebase.auth().signOut()\r\n        .then(()=>{\r\n            localStorage.removeItem('FBIdToken')\r\n            localStorage.removeItem('userData')\r\n            dispatch(setUnauthenticated())\r\n            window.location.reload()\r\n        })\r\n        .catch((err)=>{\r\n            dispatch(signoutError(err))\r\n        })\r\n    }\r\n}\r\nexport const getSpecific = (handle)=>{\r\n    return (dispatch)=>{\r\n        let userData={};\r\n        db.doc(`/users/${handle}`).get()\r\n        .then((doc)=>{\r\n            if(doc.exists){\r\n                userData.user=doc.data();\r\n                return db.collection('posts').where('userHandle','==',handle).orderBy('createdAt','desc').get()\r\n            }\r\n            else{\r\n                console.log('User not found')\r\n            }\r\n        })\r\n        .then((data)=>{\r\n            userData.posts=[];\r\n            data.forEach((doc)=>{\r\n                userData.posts.push({\r\n                    body: doc.data().body,\r\n                    createdAt: doc.data().createdAt,\r\n                    userHandle: doc.data().userHandle,\r\n                    userImage: doc.data().userImage,\r\n                    likeCount: doc.data().likeCount,\r\n                    commentCount: doc.data().commentCount,\r\n                    postImage: doc.data().postImage,\r\n                    postId: doc.id\r\n                })\r\n            })\r\n            dispatch(getSpecificUserData(userData))\r\n        })\r\n        .catch((err)=>{\r\n            console.log(err);\r\n        })\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}